\d
\q
\i aps_rqst_queue
\i aps_rqst_queue.sql
exit
\q
\i ic_item_mast_equiv.sql 
commit;
\q
\i
\i ic_item_cust_subst.sql 
\q
\i ic_item_cust_subst.sql 
\q
\i ic_item_cust_subst.sql 
\q
\i aps_tables.sql 
\q
\d tmp_item;
\q
describe na_item_mast
;
\d na_item_mast
\d ic_item_mast
\d
\q
\d ic_item_mast
set role apps;
\d ic_item_mast
exit
\q
\dt ic_item_mast
set search_path to na;
\d ic_item_mast
set role apps;
\d ic_item_mast;
exit
\q
\d ic_item_Mast
set role apps
\d ic_item_mast
show search_path
current_schema()
;
current_schema();
show search_path;
\d ic_item_mast
quit
\q
set role apps
\d ic_item_mast
\d
quit
\q
set search_path to na;
\d ic_item_mast
\d
set role apps;
\d
\q
\d ic_item_mast
set role apps
\d ic_item_mast
set role na
\d ic_item_mast
\d
  \q
\d aps_dmd_oo
\d ic_item_mast
set role apps
\d ic_item_mast
set search_path to na
\d ic_item_mast
set search_path to apps
\d ic_item_mast
\d 
  set search_path to na;
  set search_path to na;
\d
ls -ltr
pwd
\q
\d aps_dmd_oo
set search_path to apps;
\d aps_dmd_oo
\q
\d aps_dmd_oo
set role apps
\d aps_dmd_oo
set search_path to na;
set search_path to na;
\d aps_dmd_oo
\d ic_item_mast
\q
\d ic_item_mast
set role apps
\d ic_item_mast
set role na
\d ic_item_mast
set search_path to na;
set search_path to na;
\d ic_item_mast
\q
\d ic_item_mast
set search_path to na;
\d ic_item_mast
\d
\q
\d
                 \q
\d ic_item_mast
\q
\i aps_tables.sql
\d po_ord_hdr
set search_path to na;
\d po_ord_hdr
set role apps
\d po_ord_hdr
\d ic_item_mast
set search_path to na;
set search_path to na;
\d ic_item_mast
set search_path to apps
;
\d ic_item_mast
\d ic_item_mast
\d *.*
\dt *.*
quit
\q
set search_path to public;
\d ic_item_mast
\q
\d po_requisition
\d *.po_requistion
\q
drop schema aerospace;
drop schema aerospace cascade;
\q
vim ~/.bashrc
vim ~/.bashrc
;;
;
\q
\q
current_schema();
current_schema;
current_schema();
show current_schema;
show search_path;
set current_schema to aps;
set search_path to aps;
\dt
exit
\q
\i aps18_postgres_tables.sql 
create schema aerospace;
\i aps18_postgres_tables.sql 
\q
\i aps18_postgres_tables.sql 
\q
\q
\i aps18_postgres_tables.sql 
drop schema aerspace cascade;
drop schema aerospace cascade;
\i aps18_postgres_tables.sql 
\q
drop schema aerospace cascade;
exit
\q
quit
\q
\q
\q
drop tablespace aerospace cascade;
drop schema aerospace cascade;
exit
\q
drop schema aerospace cascade;
e
\q
\d
alter user jjs search_path aerospace;
alter user jjs set search_path to aerospace;
\q
\dt
                select count(*) from ic_item_mast;
exit
\q
quit
\q
drop constraint asr_asrs_fk;
alter table aps_src_rule drop constraint asr_asrs_fk;
\q
select count(*) from ic_item_mast;
\q
drop schema aerospace cascade;
select count(*) from ic_item_mast;
\q
quit
\q
select count(*) from ic_item_mast;
set search_path to aerospace;
select count(*) from ic_item_mast;
drop schema aerospace cascade;
select count(*) from ic_item_mast;
\q
select count(*) from ic_lot_mast;
\q
\i /tmp/data.sql
select count(*) from aps_dmd_rule_set_item;
commit;
select count(*) from aps_dmd_rule_set_item;
\q
select count(*) from aps_dmd_rule_set_item;
delete from aps_dmd_rule_set_item;
commit;
select count(*) from ic_lot_mast;
\quit
\i aps18_postgres_data.sql
select count(*) from ic_item_mast;
exit
\q
\q
\i aps18_postgres_data.sql
select count(*) from ic_iteM_mast;
\q
select count(*) from ic_item_mast;
exi
\q
select count(*) from ic_item_mast;
\q
select count(*) from aps_sply_facility_item;
select * from aps_src_rule_set;
set autocommit on;
autocommit on;
set autocommit;
set autocommit to on;
set autocommit = on;
set autocommit;
\set AUTOCOMMIT on;
\set AUTOCOMMIT on
select count(*) from ic_item_mast;
\q
select count(*) from ic_item_mast;
\e
select count(*) from ic_item_mast;
\q
drop schema aerospace cascade;
\q
\d *.ic_item_mast
select count(*) from ic_item_mast;
\q
select count(*) from ic_item_mast;
\q
\i aps18_postgres_tables.sql 
\q
\i aps18_postgres_tables.sql 
drop schema aerospace cascade;
\i aps18_postgres_tables.sql 
\i aps18_postgres_data.sql 
select count(*) from ic_item_Mast;
\q
\i aps18_postgres_data.sql
\d
;
\d
;
end;
\d
quit
\q
\i aps18_postgres_tables.sql 
\q
\d aps_rqst_queue
alter role jjs search_path aerospace;
alter role jjs set search_path to aerospace;
\d
quit
\q
\d aps_rqst_grp
\q
\d aps_dmd_oo
\q
drop view aps_dmd_oo;
\q
\d aps_dmd_oo
\w
\q
drop view aps_dmd_oo;
drop view aps_dmd_oo;
commit;
\q
select count(*) from aps_dmd_oo;
select count(*) from oe_ord_dtl;
exit
\q
select count(*) from oe_ord_dtl;
select count(*) from oe_ord_hdr;
exit
select count(*) from aps_dmd_oo;
select count(*) from aps_dmd_oo;
\quit
select count(*) from oe_cust_mast;
select count(*) from na_org_cust;
select count(*) from na_org;
select count(*) from na_org_cust;
select count(*) from na_org_cust;
select count(*) from na_org;
select count(*) from aps_dmd_oo;
select count(*) from aps_dmd_fc;
\dt
\dt *.aps*
\q
\timing -- show how long a command takes
\timing 
\timing on
alias aps18
alias | grep aps18
;
\q
 SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || to_char(ood.line_nbr::dou
ble precision, '999999999'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - COALESCE(ood.qty_ship_stk_um, 0::do
uble precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - COALESCE(ood.qty_ship_stk_um, 0::do
uble precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - COALESCE(ood.qty_ship_stk_um, 0::do
uble precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - COALESCE(ood.qty_ship_stk_um, 0::do
uble precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;kkkkkuuuuuuuuuuq
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - COALESCE(ood.qty_ship_stk_um, 0::do
uble precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - COALESCE(ood.qty_ship_stk_um, 0::do
uble precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr AND ood.org_nbr_cust = ocm.org_nbr_cust AND ood.org_n
br_cust = cust.org_nbr AND ood.line_stat_id::text = 'O'::text AND (COALESCE(ood.qty_ord_stk_um, 0::do
uble precision) - COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision AND ood.c
ancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::double precision, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::int, '9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-'::text) || 
	to_char(ood.line_nbr::int,'9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || '-Line: '::text) || 
	to_char(ood.line_nbr::int,'9'::text) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || 
	'-Line: '::text) || trim(to_char(ood.line_nbr::int,'9'::text)) AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || 
	'-Line:'::text) || lpad(trim(to_char(ood.line_nbr::int,'9'::text)),5,'0') AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || 
	'-'::text) || lpad(trim(to_char(ood.line_nbr::int,'9'::text)),5,'0') AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
create or replace view aps_dmd_oo as
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || 
	'-'::text) || lpad(trim(to_char(ood.line_nbr::int,'9'::text)),5,'0') AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\e
create or replace view aps_dmd_oo as
SELECT 'OO'::character varying(2) AS dmd_type_cd,
    ((ooh.ord_type_cd::text || ooh.ord_cd::text) || 
	'-'::text) || lpad(trim(to_char(ood.line_nbr::int,'9'::text)),5,'0') AS dmd_cd,
    ood.item_nbr_ord AS item_nbr_dmd,
    ood.oe_ord_dtl_nbr,
    ood.rqst_dt,
    ood.prom_dt_curr,
    ood.aps_src_rule_set_nbr,
    ood.org_nbr_cust,
    COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
	COALESCE(ood.qty_ship_stk_um, 0::double precision) AS open_qty,
    ood.qty_alloc_stk_um AS open_qty_adj,
    cust.org_cd AS org_cd_cust,
    ood.org_nbr_mfr_rqst,
    pmm.org_cd AS org_cd_mfr,
        CASE
            WHEN ood.contract_cd IS NULL THEN 'N'::text
            ELSE 'Y'::text
        END AS contract_cust_flg,
    ood.unit_price_stk_um AS unit_price,
    ocm.cust_alloc_prty,
    ood.rev_lvl,
    ood.cntry_cd_origin,
    ood.lot_not_expire_before_dt,
    ood.lot_manufacture_after_dt,
        CASE
            WHEN ood.contract_cd IS NULL THEN ocm.fcst_grp
            ELSE ( SELECT occ.fcst_grp
               FROM oe_cust_contract occ
              WHERE occ.org_nbr_cust = ood.org_nbr_cust AND occ.contract_cd::text = ood.contract_cd::
text)
        END AS fcst_grp,
    ood.ship_from_facility
   FROM oe_ord_hdr ooh,
    oe_cust_mast ocm,
    na_org cust,
    oe_ord_dtl ood
     LEFT JOIN na_org pmm ON ood.org_nbr_mfr_rqst = pmm.org_nbr
  WHERE ood.oe_ord_hdr_nbr = ooh.oe_ord_hdr_nbr 
	AND ood.org_nbr_cust = ocm.org_nbr_cust 
	AND ood.org_nbr_cust = cust.org_nbr 
	AND ood.line_stat_id::text = 'O'::text 
	AND (COALESCE(ood.qty_ord_stk_um, 0::double precision) - 
		COALESCE(ood.qty_ship_stk_um, 0::double precision)) > 0::double precision 
	AND ood.cancel_cd IS NULL;
\q
\q
\d aps_src_rule
\d aps_sply_onhand;
\d aps_avail_onhand;
\d aps_sply_sub_pool;
\d aps_sply_src_rule;
\d aps_sply_src_rule_set;
\d  aps_src_rule_set;
describe aps_src_rule;
\d aps_src_rule
\d aps_sply_onhand;
\d aps_supply_onhand;
\d aps_sply_onhand;
\d aps_avail_onhand;
\d aps_sply_replen;
\d aps_avail_replen;
\d aps_avail_onhand;
\q
select count(*) from tmp_item;
\q
select * from aps_sply_rule_set;
describe aps_src_rule_set;
\d aps_src_rule_set;
quit
cd
\q
\d aps_sply_sub_pool
\d aps_sply_pool;
\\q
\q
select * from aps_src_rule;
             
\q
\d  aps_sply_src_rule;
\d  aps__src_rule;
\d  aps_src_rule;
select * from aps_sply_sub_pool  where aps_sply_sub_pool_nbr in 
(select aps_sply_sub_pool_nbr from aps_sply_rule where aps_sply_rule_nbr in (1,2));
\e
select * from aps_sply_sub_pool  where aps_sply_sub_pool_nbr in 
(select aps_sply_sub_pool_nbr from aps_src_rule where aps_sply_rule_nbr in (1,2));
r
\e
r
select * from aps_sply_sub_pool  where aps_sply_sub_pool_nbr in 
(select aps_sply_sub_pool_nbr from aps_src_rule where aps_sply_rule_nbr in (1,2));
\e
select * from aps_sply_sub_pool  where aps_sply_sub_pool_nbr in 
(select aps_sply_sub_pool_nbr from aps_src_rule where aps_src_rule_nbr in (1,2));
r
\e
r
select * from aps_sply_sub_pool  where aps_sply_sub_pool_nbr in 
(select aps_sply_sub_pool_nbr from aps_src_rule where aps_src_rule_nbr in (1,2));
\e
r

select * from aps_sply_sub_pool  where aps_sply_sub_pool_nbr in 
(select aps_sply_sub_pool_nbr from aps_src_rule where aps_src_rule_nbr in (1,2));
cd /common/backups
ls
ls
\q
select count(*) from tmp_item;
\d aps_dmd_ss;
    select count(*) from aps_dmd_ss where item_nbr_dmd = 98565;
\q\
l
\l
\q
select count(*) from tmp_item;
select * from pga_stat_activity;
select * from pg_stat_activity;
pwd
\q
\dt ut_condition_rule
set search_path to sales_reporting
\dt ut_condition_rule;
\d
               quit\
\q
\d
            set search_path to sales;
\d
\d *.*
\d *.etl_file
set search_path to public;
\d ut_conditition_rule;
\d ut_conditition_rule
\d ut*.*
\d *ut*
\d *.*condition*
\d ut_condition_run_step
\d *.ut_condition_run_step
pwd\
\q
\dt *.*subst*
\d aps_src_rule_set
\d aps_src_rule
\dt aps_sply_sub_pool
select sply_type_id, count(*) from aps_sply_sub_pool group by sply_type_id;
select sply_type_id, count(*) from aps_scr_rule group by sply_type_id;
select sply_type_id, count(*) from aps_src_rule group by sply_type_id;
\dt aps_sply_sub_pool;
\d aps_sply_sub_pool;
 select sply_pool_type_id, count(*) from aps_sply_sub_pool;
 select sply_pool_type_id, count(*) from aps_sply_sub_pool group by sply_pool_type_id;
\q
\q
select 'x';
\q
\t etl_sale
\dt
set search_path to sales_reporting
\dt
\q
\dt
\dt *.*
       set search_path to public
\dt
set search_path to  public;
\dt public.*
\d etl_sale
\d public.etl_sale
set search_path to public;
\dt
\dt etl_sale;
\d etl_sale;
select case_gtin, sum(extended_net_amt) extended_net_amt_sum
from etl_sale
group by case_gtin
order by sum(extended_net_amt) desc
limit 50;
select count(*) from etl_sale;
set search_path to integration_test;
\dt
select count(*) from etl_sale;
select case_gtin, sum(extended_net_amt) extended_net_amt_sum
from etl_sale
group by case_gtin
order by sum(extended_net_amt) desc
limit 50;
select sum(extended_net_amt)
from etl_sale
where case_gtin in (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
);
select sum(extended_net_amt)
from etl_sale
where case_gtin in (
        select case_gtin
        from etl_sale
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
);
\dt etl_sale
\d etl_sale
select sum(extended_net_amt)
from etl_sale
where case_gtin in (
        select case_gtin
        from etl_sale
        where invoice_dt  > now() - interval '1 year';
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
);
select sum(extended_net_amt)
from etl_sale
where case_gtin in (
        select case_gtin
        from etl_sale
        where invoice_dt  > now() - interval '1 year';
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
);
\e
select sum(extended_net_amt)
from etl_sale
where case_gtin in (
        select case_gtin
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
);
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
\e
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
r
select 'x';
;
r;
\e
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
\e
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
r
select 'x';
\dt etl_sale
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
select
;
\
select 'x'
\q
set search_path to integration_test;
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
select 'x';
\q
set search_path to integration_test;
select 'x';
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
\e
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;
edit
\e
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
select top_sales.case_gtin, top_sales.extended_net_amt_sum
from total_sales;
edit
\e
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
select top_sales.case_gtin, top_sales.extended_net_amt_sum
from total_sales;

r
\q
set search_path to integration_schema;
with total_sales as  (
        select sum(extended_net_amt) tot_sale
        from etl_sale
        where case_gtin in (
                select case_gtin
                from etl_sale
                where invoice_dt  > now() - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 50
        )
with top_sales as (
        select case_gtin, sum(extended_net_amt) extended_net_amt_sum
        from etl_sale
        where invoice_dt  > now() - interval '1 year'
        group by case_gtin
        order by sum(extended_net_amt) desc
        limit 50
)
select top_sales.case_gtin, top_sales.extended_net_amt_sum, total_sales.tot_sale
from total_sales, top_sales;

create or replace view
customer_vw as
select distinct ship_to_cust_id
from etl_sale;

create or replace view effective_date as
select max(invoice_dt) report_date from etl_sale;


create or replace view product_rank_12_vw as
select case_gtin, sum(extended_net_amt) sum_ext
from etl_sale,
     effective_date
where invoice_dt  > effective_date.report_date - interval '1 year'
                group by case_gtin
                order by sum(extended_net_amt) desc
                limit 20
        ;

create or replace view product_undersold_by_customer_vw as
select customers.ship_to_cust_id,
       top_products.case_gtin
from customers,
     top_products
where not exists
  ( select 'x' from etl_sale, top_products
    where
        etl_sale.ship_to_cust_id = customers.ship_to_cust_id  and
        etl_sale.case_gtin = top_products.case_gtin
  )
order by customers.ship_to_cust_id, 
	 case_gtin;
